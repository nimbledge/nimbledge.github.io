<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Steam Wrapped</title>
<style>
body { margin:0; font-family:'Montserrat', sans-serif; background:#121212; color:#fff; scroll-behavior:smooth; }
h1,h2,p { margin:0; text-align:center; }
h1 { font-weight:900; font-size:6vw; line-height:1.2; margin-bottom:10px; }
h2 { font-weight:700; font-size:3vw; color:#eee; line-height:1.2; margin-bottom:10px; }
p { font-size:1.8vw; color:#ddd; margin-bottom:20px; }

section { display:flex; flex-direction:column; justify-content:center; align-items:center; padding:60px 20px; box-sizing:border-box; overflow:hidden; min-height:100vh; }

/* Gradients */
.gradient-1 { background: linear-gradient(135deg, #0f2027,#203a43,#2c5364); }
.gradient-2 { background: linear-gradient(135deg,#1db954,#1ed760); }
.gradient-3 { background: linear-gradient(135deg,#9146ff,#bc67ff); }
.gradient-4 { background: linear-gradient(135deg,#1fadff,#ff9068); }
.gradient-5 { background: linear-gradient(135deg,#00c6ff,#0072ff); }
.gradient-6 { background: linear-gradient(135deg,#ff0084,#33001b); }

.year { font-size:8vw; }

/* Top Games */
.top-games-wrapper { display:flex; flex-wrap:wrap; gap:40px; max-width:1100px; margin-top:50px; align-items:stretch; justify-content:center; }
.top-games-list { flex:1; display:flex; flex-direction:column; justify-content:flex-start; gap:15px; min-width:300px; }
.game-card { display:grid; grid-template-columns:50px 1fr; gap:12px; background: rgba(0,0,0,0.28); padding:18px; border-radius:4px; backdrop-filter: blur(8px); align-items:center; }
.rank { font-size:3vw; font-weight:900; text-align:center; }
.game-info strong { font-size:2.5vw; font-weight:800; }
.game-info span { font-size:2vw; opacity:1; }
.featured-game { width:320px; background: rgba(0,0,0,0.35); padding:22px; border-radius:4px; backdrop-filter: blur(6px); text-align:center; box-shadow: 0 6px 18px rgba(0,0,0,0.25); display:flex; flex-direction:column; gap:15px; }
.featured-game img { width:100%; border-radius:4px; }

/* Monthly Graph */
.month-column-wrapper { display:flex; justify-content:space-between; align-items:flex-end; gap:10px; width:90%; max-width:1400px; height:60vh; margin-top:15px; overflow:visible; }
.month-column { display:flex; flex-direction:column; justify-content:flex-end; align-items:center; width:60px; height:100%; position:relative; }
.bar-stack { display:flex; flex-direction:column; justify-content:flex-end; width:100%; height:100%; }
.game-bar { width:100%; position:relative; border-radius:4px; margin:0; cursor:pointer; transition: transform 0.2s; min-height:4px; background-size:cover; background-position:center; }
.game-bar:hover { transform: scaleY(1.05); z-index:2; }
.tooltip { position:absolute; z-index:99999; bottom:110%; left:50%; transform:translateX(-50%); padding:4px 6px; background:rgba(0,0,0,0.85); color:white; font-size:12px; white-space:nowrap; opacity:0; pointer-events:none; border-radius:4px; transition:0.15s; }
.game-bar:hover .tooltip { opacity:1; }
.month-label { margin-top:6px; font-size:1.2vw; color:#fff; text-align:center; }

/* Responsive */
@media(max-width:900px){
  h1 { font-size:10vw; }
  h2 { font-size:5vw; }
  p { font-size:3vw; }
  .rank { font-size:5vw; }
  .game-info strong { font-size:4vw; }
  .game-info span { font-size:3.5vw; }
  .month-label { font-size:3vw; }
  .tooltip { font-size:3vw; }
}
</style>
</head>
<body>

<section class="gradient-1">
  <h1 class="year"></h1>
  <h2>Your Gaming Year</h2>
  <p>Scroll down to see your Steam-style year in games</p>
</section>

<section class="gradient-2">
  <h1>0</h1>
  <h2>Hours Played</h2>
  <p>0</p>
</section>

<section class="gradient-3">
  <h1>Top Tags</h1>
  <h2>Action • Adventure • Indie • RPG</h2>
  <p>The genres that dominated your year</p>
</section>

<section class="gradient-4">
  <h1>Top Games Each Month</h1>
  <div class="month-column-wrapper" id="month-graph"></div>
</section>

<section class="gradient-5">
  <h1>Most Played Game</h1>
  <div class="featured-game">
    <img src="">
    <h2>Game</h2>
    <p>0 hrs</p>
  </div>
</section>

<section class="gradient-6">
  <h1>Your Top Games</h1>
  <div class="top-games-wrapper">
    <div class="top-games-list"></div>
    <div class="featured-game">
      <img src="">
      <h2>Game</h2>
      <p>0 hrs</p>
    </div>
  </div>
</section>

<script>
const PDB_NAME = "PlaytimeDB";
const PSTORE_NAME = "playtimeLogs";

function PopenB() {
  return new Promise((resolve,reject)=>{
    let req = indexedDB.open(PDB_NAME,1);
    req.onsuccess = e => resolve(e.target.result);
    req.onerror = e => reject(e.target.error);
    req.onupgradeneeded = e => {
      const db = e.target.result;
      if(!db.objectStoreNames.contains(PSTORE_NAME)){
        db.createObjectStore(PSTORE_NAME, {keyPath:"gameId"});
      }
    };
  });
}

function formatTime(mins){ return mins<120 ? mins+" min" : Math.round(mins/60*10)/10+" hrs"; }
function formatHours(mins){ return (mins/60).toFixed(1); }

document.addEventListener("DOMContentLoaded",async()=>{
  const db = await PopenB();
  const tx = db.transaction(PSTORE_NAME,"readonly");
  const store = tx.objectStore(PSTORE_NAME);

  const monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
  const allGames = await new Promise(resolve=>{
    const res = [];
    store.openCursor().onsuccess=e=>{
      const cursor=e.target.result;
      if(cursor){ res.push(cursor.value); cursor.continue(); }
      else resolve(res);
    };
  });

  const totalPlaytime={}; 
  const monthlyGamesColumn={}; 
  monthNames.forEach(m=>monthlyGamesColumn[m]=[]);

  allGames.forEach(entry=>{
    const game = entry.gameId;
    const logs = entry.logs;
    totalPlaytime[game] = logs.length; // each log = 1 minute

    const monthCount={}; monthNames.forEach(m=>monthCount[m]=0);
    logs.forEach(l=>{
      const [d]=l.split(','); 
      const [day,month]=d.split('/').map(Number);
      monthCount[monthNames[month-1]]++;
    });

    monthNames.forEach(m=>{
      if(monthCount[m]>0){
        monthlyGamesColumn[m].push({
          game,
          mins: monthCount[m]
        });
      }
    });
  });

  const totalMinutes = Object.values(totalPlaytime).reduce((a,b)=>a+b,0);
  document.querySelector('.year').textContent = new Date().getFullYear()+' Wrapped';
  const hoursSection = document.querySelector('.gradient-2');
  hoursSection.querySelector('h1').textContent = formatHours(totalMinutes);
  hoursSection.querySelector('p').textContent = formatTime(totalMinutes);

  const topGames = Object.keys(totalPlaytime).sort((a,b)=>totalPlaytime[b]-totalPlaytime[a]).slice(0,5);
  const mostPlayed = topGames[0]||"No Data";

  const listWrapper = document.querySelector('.top-games-list'); listWrapper.innerHTML='';
  topGames.forEach((game,i)=>{
    const card = document.createElement('div'); card.className='game-card';
    card.innerHTML=`<div class="rank">${i+1}</div>
      <div class="game-info"><strong>${game}</strong><br><span>${formatTime(totalPlaytime[game])}</span></div>`;
    listWrapper.appendChild(card);
  });

  const featured = document.querySelectorAll('.featured-game');
  featured.forEach(f=>{
    f.querySelector('h2').textContent = mostPlayed;
    f.querySelector('p').textContent = formatTime(totalPlaytime[mostPlayed]||0);
    f.querySelector('img').src = `images/games-512/${mostPlayed}.png`;
  });

  // Monthly graph
  const wrapper = document.getElementById('month-graph'); wrapper.innerHTML='';
  const maxTotal = Math.max(...monthNames.map(m=>monthlyGamesColumn[m].reduce((a,b)=>a+b.mins,0)),1);

  monthNames.forEach(month=>{
    const col = document.createElement('div'); col.className='month-column';
    const stack = document.createElement('div'); stack.className='bar-stack';

    monthlyGamesColumn[month].sort((a,b)=>b.mins-a.mins).forEach(item=>{
      const bar = document.createElement('div'); bar.className='game-bar';
      bar.style.height = (item.mins/maxTotal*100)+'%';
      bar.style.backgroundImage = `url(images/games-512/${item.game}.png)`;
      bar.style.backgroundSize = 'cover';
      bar.style.backgroundPosition = 'center';
      bar.style.backgroundRepeat = 'no-repeat';

      const tip = document.createElement('div'); tip.className='tooltip';
      tip.textContent = `${item.game}: ${formatTime(item.mins)}`;
      bar.appendChild(tip);
      stack.appendChild(bar);
    });

    col.appendChild(stack);
    const label = document.createElement('div'); label.className='month-label'; label.textContent=month;
    col.appendChild(label);
    wrapper.appendChild(col);
  });
});
</script>
</body>
</html>
